#!/bin/bash
set -e

# Criar pastas
mkdir -p ~/pterodactyl/panel
mkdir -p ~/pterodactyl/wings

# Criar docker-compose para o Painel
cat > ~/pterodactyl/panel/docker-compose.yml << 'EOF'
version: '3.8'

services:
  panel:
    image: ghcr.io/pterodactyl/panel:latest
    restart: always
    ports:
      - "8080:80"
    environment:
      - APP_URL=http://localhost:8080
      - APP_TIMEZONE=UTC
      - DB_HOST=database
      - DB_PORT=3306
      - DB_DATABASE=panel
      - DB_USERNAME=pterodactyl
      - DB_PASSWORD=CHANGE_ME
    volumes:
      - ./var/:/app/var
      - ./nginx/:/etc/nginx/conf.d
    depends_on:
      - database

  database:
    image: mariadb:10.11
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=CHANGE_ROOT
      - MYSQL_DATABASE=panel
      - MYSQL_USER=pterodactyl
      - MYSQL_PASSWORD=CHANGE_ME
    volumes:
      - ./database:/var/lib/mysql

  cache:
    image: redis:alpine
    restart: always
EOF

# Criar docker-compose para o Wings
cat > ~/pterodactyl/wings/docker-compose.yml << 'EOF'
version: '3.8'

services:
  wings:
    image: ghcr.io/pterodactyl/wings:latest
    restart: always
    network_mode: host
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./data:/etc/pterodactyl
EOF

# Subir containers
docker compose -f ~/pterodactyl/panel/docker-compose.yml up -d
docker compose -f ~/pterodactyl/wings/docker-compose.yml up -d

echo "âœ… Pterodactyl Panel e Wings instalados e rodando!"
echo "ðŸ‘‰ Painel em: http://localhost:8080"
